<head>
<script src="https://aframe.io/releases/0.7.1/aframe.min.js"></script>
<script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
<script>
  // Script handling audio

  /**
   * Function to initialize new audio file to play when a marker is located
   * To initialize a new audio handler, add the `id` attribute and handler name to the desired HTML a-marker tag
   * Eg. <a-marker id = "marker_id", handler_name>
   * Then call this function with the parameters accordingly
   * @param audio_path String path of the audio file
   * @param marker_id String id given to the marker (added to the a-marker tag in the HTML)
   * @param handler_name String name given to the handler to be registered to the marker (also added to the HTML a-marker tag)
  **/

  function initAudio(audio_path, marker_id, handler_name) {

    // Create HTML5 audio element

    var audio = new Audio(audio_path)

    // Register audio playing component

    AFRAME.registerComponent(handler_name, {
      init: function() {
        // Set up the tick throttling. Will check if marker is active every 500ms
        this.tick = AFRAME.utils.throttleTick(this.tick, 500, this);
      },
      tick: function(t, dt) {
        if (document.querySelector('#' + marker_id).object3D.visible == true) {
          // MARKER IS PRESENT: play audio
          audio.play();
        } else {
          // MARKER IS HIDDEN, do nothing
        }
      }
    });
  }

  // Initialize audio files and handlers

  initAudio("testing.mp3", "animated-marker", "markerhandler");
  initAudio("res/PCB_Fabrication/PCB_Fabrication.mp3", "barcode_0", "barcode_0_handler");
  initAudio("Lasercutter.mp3", "barcode_1", "barcode_1_handler");

</script>
</head>

<body style='margin : 0px; overflow: hidden;'>
<a-scene embedded="" arjs="trackingMethod: best; detectionMode: mono_and_matrix; matrixCodeType: 3x3;" class="" inspector="" keyboard-shortcuts="" screenshot="" vr-mode-ui="">
  <!-- Pre-loaded assets -->
  <a-assets>
    <img id="my-image" src="DSC_0639.JPG">
    <audio id="sound" src="testing.mp3" preload="auto"></audio>
  </a-assets>

  <!-- https://github.com/artoolkit/ARToolKit5/tree/master/doc/patterns/Matrix%20code%203x3%20(72dpi) -->
  <!-- Hiro Marker -->
  <a-marker markerhandler id="animated-marker" preset='hiro'>
    <a-entity sound="src: #sound" autoplay="true"></a-entity>
    <!-- 2D Image -->
    <a-image id="test" src="#my-image" position="0 0 0" rotation="-90 0 0" width="10" height="10" opacity="1" transparent="true" alpha-test="0.2" shader="standard" scale="0.1 0.1 0.1" visible="" material="" geometry=""></a-image>
    <!-- 3D Bee Model -->
    <a-entity gltf-model="url(cartoon_bee/scene.gltf)" scale="0.1 0.1 0.1" rotation = "270 0 0" position = "-0.5 -0.5 -1"></a-entity>

  </a-marker>

  <!-- Barcode Marker 0 -->
  <a-marker barcode_0_handler id = "barcode_0" type="barcode" value="0">
    <a-entity sound="src: #sound" autoplay="true"></a-entity>
    <!-- 2D Image -->
    <a-image id="test" src="#my-image" position="0 0 0" rotation="-90 0 0" width="10" height="10" opacity="1" transparent="true" alpha-test="0.2" shader="standard" scale="0.1 0.1 0.1" visible="" material="" geometry=""></a-image>
    <!-- 3D Bee Model -->
    <a-entity gltf-model="url(cartoon_bee/scene.gltf)" scale="0.1 0.1 0.1" rotation = "270 0 0" position = "-0.5 -0.5 -1"></a-entity>
  </a-marker>

  <!-- Barcode Marker 1 -->
  <a-marker barcode_1_handler id = "barcode_1" type="barcode" value="1">
    <a-entity sound="src: #sound" autoplay="true"></a-entity>
    <!-- 2D Image -->
    <a-image id="test" src="#my-image" position="0 0 0" rotation="-90 0 0" width="10" height="10" opacity="1" transparent="true" alpha-test="0.2" shader="standard" scale="0.1 0.1 0.1" visible="" material="" geometry=""></a-image>
    <!-- 3D Bee Model -->
    <a-entity gltf-model="url(cartoon_bee/scene.gltf)" scale="0.1 0.1 0.1" rotation = "270 0 0" position = "-0.5 -0.5 -1"></a-entity>
  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<script>
AFRAME.registerComponent('soundhandler', {
    tick: function () {
           var entity = document.querySelector('[sound]');
         if (document.querySelector('a-marker').object3D.visible == true) {
            entity.components.sound.playSound();
        } else {
            entity.components.sound.pauseSound();
        }

     }
});
</script>



</body>
